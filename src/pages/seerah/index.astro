---
import Layout from "../../layouts/Layout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";
import EpisodeCard from "../../components/EpisodeCard.astro";
import { episodes } from "../../data/episodes";

const allEpisodes = episodes.map((ep) => ({
    ...ep,
    description: `Episode ${ep.id}: ${ep.title}. A comprehensive study of the Seerah by Shaykh Abdul Nasir Jangda.`,
    date: "2024 Series",
    image: "https://ia903208.us.archive.org/22/items/seerah_life_of_the_prophet_saw/___ia_thumb.jpg?cnt=0",
}));
---

<Layout title="Browse Episodes | Seerah of the Prophet Ô∑∫">
    <Navbar />

    <header class="page-header">
        <div class="container text-center">
            <span class="badge">Prophetic Biography</span>
            <h1>
                Discover the Life of <br /><span class="gradient-text"
                    >The Messenger Ô∑∫</span
                >
            </h1>
            <p>
                An immersive 200-episode journey through the life, teachings,
                and legacy of Prophet Muhammad Ô∑∫, authored by Shaykh Abdul Nasir
                Jangda.
            </p>
        </div>
    </header>

    <main class="container">
        <div class="search-section">
            <div class="search-container glass-card">
                <div class="search-wrapper">
                    <span class="search-icon">üîç</span>
                    <input
                        type="text"
                        id="episodeSearch"
                        placeholder="Search by topic or episode number (e.g. 'Badr' or '045')..."
                        autocomplete="off"
                    />
                </div>
                <div class="search-footer">
                    <div class="stats-bar">
                        ‚ú® Showing <span id="resultCount"
                            >{allEpisodes.length}</span
                        > curated episodes
                    </div>
                </div>
            </div>
        </div>

        <div class="episodes-grid" id="episodesGrid">
            {
                allEpisodes.map((episode) => (
                    <div
                        class="episode-item reveal-on-scroll"
                        data-title={episode.title.toLowerCase()}
                        data-id={episode.id}
                    >
                        <EpisodeCard episode={episode} />
                    </div>
                ))
            }
        </div>

        <div id="noResults" class="no-results hidden">
            <div class="no-results-content glass-card">
                <span class="icon">ü§î</span>
                <h3>No matches found</h3>
                <p>
                    We couldn't find any episodes matching your search. Try a
                    different keyword.
                </p>
                <button id="clearSearch" class="btn-primary"
                    >Clear and View All</button
                >
            </div>
        </div>
    </main>

    <Footer />
</Layout>

<script>
    const searchInput = document.getElementById(
        "episodeSearch",
    ) as HTMLInputElement;
    const episodesGrid = document.getElementById("episodesGrid");
    const episodeItems = document.querySelectorAll(".episode-item");
    const resultCount = document.getElementById("resultCount");
    const noResults = document.getElementById("noResults");
    const clearBtn = document.getElementById("clearSearch");

    // Scroll Animation Observer
    const observerOptions = {
        root: null,
        rootMargin: "0px",
        threshold: 0.1,
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                entry.target.classList.add("is-visible");
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    function initReveal() {
        document
            .querySelectorAll(".reveal-on-scroll")
            .forEach((el) => observer.observe(el));
    }

    initReveal();

    function filterEpisodes() {
        if (!searchInput || !episodesGrid || !resultCount || !noResults) return;

        const query = searchInput.value.toLowerCase();
        let count = 0;

        episodeItems.forEach((item) => {
            const title = item.getAttribute("data-title") || "";
            const id = item.getAttribute("data-id") || "";

            if (title.includes(query) || id.includes(query)) {
                (item as HTMLElement).style.display = "block";
                count++;
            } else {
                (item as HTMLElement).style.display = "none";
            }
        });

        resultCount.textContent = count.toString();

        if (count === 0) {
            episodesGrid.style.display = "none";
            noResults.classList.remove("hidden");
        } else {
            episodesGrid.style.display = "grid";
            noResults.classList.add("hidden");
        }
    }

    if (searchInput) {
        searchInput.addEventListener("input", filterEpisodes);
    }

    if (clearBtn && searchInput) {
        clearBtn.addEventListener("click", () => {
            searchInput.value = "";
            filterEpisodes();
            searchInput.focus();
        });
    }
</script>

<style>
    .page-header {
        padding: 8rem 0 5rem;
        background:
            radial-gradient(
                circle at 10% 10%,
                rgba(72, 119, 146, 0.05),
                transparent 40%
            ),
            radial-gradient(
                circle at 90% 90%,
                rgba(26, 54, 94, 0.03),
                transparent 40%
            );
    }

    .text-center {
        text-align: center;
    }

    h1 {
        font-size: 4.5rem;
        font-weight: 800;
        line-height: 1.1;
        margin-bottom: 1.5rem;
        letter-spacing: -0.02em;
    }

    .page-header p {
        font-size: 1.4rem;
        color: var(--text-muted);
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.6;
    }

    .badge {
        display: inline-block;
        padding: 0.6rem 1.2rem;
        background: rgba(72, 119, 146, 0.1);
        color: var(--cerulean);
        border-radius: 50px;
        font-weight: 700;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 2rem;
    }

    .search-section {
        margin-top: -3rem;
        position: relative;
        z-index: 10;
        margin-bottom: 5rem;
    }

    .search-container {
        padding: 3rem;
        border-radius: var(--radius-lg);
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .search-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        max-width: 900px;
        margin: 0 auto;
    }

    .search-icon {
        position: absolute;
        left: 1.5rem;
        font-size: 1.4rem;
        color: var(--cerulean);
        opacity: 0.7;
    }

    .search-wrapper input {
        width: 100%;
        padding: 1.5rem 1.5rem 1.5rem 4rem;
        border-radius: var(--radius-md);
        border: 1px solid rgba(0, 0, 0, 0.1);
        background: var(--white);
        outline: none;
        font-size: 1.25rem;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        font-family: inherit;
        box-shadow: var(--shadow-sm);
    }

    .search-wrapper input:focus {
        border-color: var(--cerulean);
        box-shadow:
            0 0 0 5px rgba(72, 119, 146, 0.08),
            0 10px 20px -5px rgba(0, 0, 0, 0.05);
        transform: translateY(-2px);
    }

    .search-footer {
        margin-top: 1.5rem;
        text-align: center;
    }

    .stats-bar {
        font-size: 1rem;
        color: var(--text-muted);
        font-weight: 500;
    }

    #resultCount {
        color: var(--oxford-navy);
        font-weight: 700;
        font-size: 1.1rem;
    }

    .episodes-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 2.5rem;
        margin-bottom: 10rem;
    }

    /* Reveal Animation Classes */
    .reveal-on-scroll {
        opacity: 0;
        transform: translateY(40px) scale(0.98);
        transition:
            opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1),
            transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .reveal-on-scroll.is-visible {
        opacity: 1;
        transform: translateY(0) scale(1);
    }

    .no-results {
        padding: 6rem 0 10rem;
        display: flex;
        justify-content: center;
    }

    .no-results-content {
        padding: 5rem;
        max-width: 600px;
        text-align: center;
        border-radius: var(--radius-lg);
    }

    .no-results .icon {
        font-size: 5rem;
        display: block;
        margin-bottom: 2rem;
    }

    .no-results h3 {
        font-size: 2.2rem;
        margin-bottom: 1rem;
    }

    .no-results p {
        font-size: 1.2rem;
        color: var(--text-muted);
        margin-bottom: 2.5rem;
    }

    .hidden {
        display: none;
    }

    @media (max-width: 1024px) {
        h1 {
            font-size: 3.5rem;
        }
        .episodes-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
        }
    }

    @media (max-width: 768px) {
        h1 {
            font-size: 2.8rem;
        }
        .page-header {
            padding: 6rem 0 4rem;
        }
        .search-container {
            padding: 1.5rem;
        }
        .search-wrapper input {
            padding: 1.2rem 1.2rem 1.2rem 3.5rem;
            font-size: 1.1rem;
        }
        .episodes-grid {
            grid-template-columns: 1fr;
            gap: 2rem;
        }
    }
</style>
