---
import Layout from "../../layouts/Layout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";
import EpisodeCard from "../../components/EpisodeCard.astro";
import { episodes } from "../../data/episodes";

const allEpisodes = episodes.map((ep) => ({
    ...ep,
    description: `${ep.title}. A comprehensive study of the Seerah by Shaykh Abdul Nasir Jangda.`,
    date: "Prophetic Biography",
    image: "/thumb.jpg",
}));
---

<Layout title="Browse Episodes | Seerah of the Prophet ﷺ">
    <Navbar />

    <header class="page-header">
        <div class="container text-center">
            <div class="header-content reveal-on-scroll">
                <span class="badge">Prophetic Biography</span>
                <h1>
                    Explore the Life of <br /><span class="gradient-text"
                        >The Final Messenger ﷺ</span
                    >
                </h1>

                <p>
                    An immersive 200-episode journey through the life,
                    teachings, and legacy of Prophet Muhammad ﷺ, authored by
                    Shaykh Abdul Nasir Jangda.
                </p>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="search-section reveal-on-scroll">
            <div class="search-box glass-card">
                <input
                    type="text"
                    id="episodeSearch"
                    placeholder="Search by topic or episode number..."
                    autocomplete="off"
                />
            </div>
            <div class="search-status">
                ✨ Showing <span id="resultCount">{allEpisodes.length}</span> curated
                episodes
            </div>
        </div>

        <div class="episodes-grid" id="episodesGrid">
            {
                allEpisodes.map((episode) => (
                    <div
                        class="episode-item reveal-on-scroll"
                        data-title={episode.title.toLowerCase()}
                        data-id={episode.id}
                    >
                        <EpisodeCard episode={episode} />
                    </div>
                ))
            }
        </div>

        <div id="noResults" class="no-results-container hidden">
            <div class="no-results-card glass-card reveal-on-scroll">
                <div class="no-results-icon">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="60"
                        height="60"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="search-icon-svg"
                        ><circle cx="11" cy="11" r="8"></circle><line
                            x1="21"
                            y1="21"
                            x2="16.65"
                            y2="16.65"></line></svg
                    >
                </div>
                <h3>The Path Continues...</h3>
                <p>
                    Even the companions sought clarity when things were hidden.
                    While we couldn't find this specific lesson, our library
                    contains hundreds of other pearls of wisdom. Try a different
                    term or return to the full path.
                </p>
                <button id="clearSearch" class="btn-primary"
                    >Return to the Path</button
                >
            </div>
        </div>
    </main>

    <Footer />
</Layout>

<script>
    const searchInput = document.getElementById(
        "episodeSearch",
    ) as HTMLInputElement;
    const episodesGrid = document.getElementById("episodesGrid");
    const episodeItems = document.querySelectorAll(".episode-item");
    const resultCount = document.getElementById("resultCount");
    const noResults = document.getElementById("noResults");
    const clearBtn = document.getElementById("clearSearch");

    // Scroll Animation Observer
    const observerOptions = {
        root: null,
        rootMargin: "20px",
        threshold: 0.1,
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                entry.target.classList.add("is-visible");
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    function initReveal() {
        document
            .querySelectorAll(".reveal-on-scroll")
            .forEach((el) => observer.observe(el));
    }

    initReveal();

    function filterEpisodes() {
        if (!searchInput || !episodesGrid || !resultCount || !noResults) return;

        const query = searchInput.value.toLowerCase();
        let count = 0;

        episodeItems.forEach((item) => {
            const title = item.getAttribute("data-title") || "";
            const id = item.getAttribute("data-id") || "";

            if (title.includes(query) || id.includes(query)) {
                (item as HTMLElement).style.display = "block";
                count++;
            } else {
                (item as HTMLElement).style.display = "none";
            }
        });

        resultCount.textContent = count.toString();

        if (count === 0) {
            episodesGrid.style.display = "none";
            noResults.classList.remove("hidden");
        } else {
            episodesGrid.style.display = "grid";
            noResults.classList.add("hidden");
        }
    }

    if (searchInput) {
        searchInput.addEventListener("input", filterEpisodes);
    }

    if (clearBtn && searchInput) {
        clearBtn.addEventListener("click", () => {
            searchInput.value = "";
            filterEpisodes();
            searchInput.focus();
        });
    }
</script>

<style>
    .page-header {
        padding: 6rem 0 4rem;
        background: radial-gradient(
            circle at 10% 10%,
            rgba(72, 119, 146, 0.05),
            transparent 40%
        );
    }

    .header-content {
        max-width: 800px;
    }

    h1 {
        font-size: clamp(2.3rem, 8vw, 4rem);
        font-weight: 800;
        line-height: 1.1;
        margin-bottom: 1.5rem;
    }

    .header-content p {
        font-size: clamp(1.1rem, 4vw, 1.25rem);
        color: var(--text-muted);
        line-height: 1.6;
    }

    .badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        background: rgba(72, 119, 146, 0.1);
        color: var(--cerulean);
        border-radius: 50px;
        font-weight: 700;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 1.5rem;
    }

    .search-section {
        margin-top: -3rem;
        margin-bottom: 5rem;
        padding-top: 3rem;
    }

    .search-box {
        padding: 0;
        overflow: hidden;
        border-radius: var(--radius-md);
        box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1);
    }

    .search-box input {
        width: 100%;
        padding: clamp(1rem, 4vw, 1.5rem) clamp(1.25rem, 5vw, 2rem);
        border: none;
        background: transparent;
        font-size: clamp(1rem, 3.5vw, 1.1rem);
        font-family: inherit;
        outline: none;
        transition: all 0.3s;
    }

    .search-box input:focus {
        background: rgba(255, 255, 255, 0.9);
    }

    .search-status {
        margin-top: 1.5rem;
        font-size: 0.95rem;
        color: var(--text-muted);
        font-weight: 500;
    }

    #resultCount {
        color: var(--cerulean);
        font-weight: 700;
    }

    .episodes-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 2.5rem;
        margin-bottom: 10rem;
    }

    /* Reveal Animation Classes */
    .reveal-on-scroll {
        opacity: 0;
        transform: translateY(40px) scale(0.98);
        transition:
            opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1),
            transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .reveal-on-scroll.is-visible {
        opacity: 1;
        transform: translateY(0) scale(1);
    }

    .no-results-container {
        padding: 4rem 0 8rem;
        display: flex;
        justify-content: center;
        width: 100%;
    }

    .no-results-card {
        padding: clamp(2rem, 8vw, 4rem) clamp(1.5rem, 6vw, 3rem);
        max-width: 550px;
        width: 100%;
        text-align: center;
        border-radius: 24px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
    }

    .no-results-icon {
        color: var(--cerulean);
        opacity: 0.3;
        margin-bottom: 0.5rem;
    }

    .no-results-card h3 {
        font-size: clamp(1.75rem, 6vw, 2.2rem);
        font-weight: 800;
        color: var(--oxford-navy);
        margin: 0;
    }

    .no-results-card p {
        font-size: clamp(1rem, 3.5vw, 1.15rem);
        color: var(--text-muted);
        line-height: 1.6;
        margin: 0;
    }

    .no-results-card button {
        margin-top: 1rem;
        width: auto;
        padding: 1rem 2.5rem;
    }

    .hidden {
        display: none;
    }

    @media (max-width: 1024px) {
        .episodes-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
        }
    }

    @media (max-width: 768px) {
        .page-header {
            padding: 4rem 0 3rem;
        }

        .search-box input {
            padding: 1rem 1.25rem;
        }

        .episodes-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
    }
</style>
